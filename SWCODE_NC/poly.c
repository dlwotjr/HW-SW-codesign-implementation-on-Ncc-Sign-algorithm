#include <stdint.h>
#include "params.h"
#include "poly.h"
#include "reduce.h"
#include "rounding.h"
#include "symmetric.h"
#include <string.h>
#include <time.h>
#include "packing.h"

#ifdef DBENCH
#include "test/cpucycles.h"
extern const uint64_t timing_overhead;
extern uint64_t *tred, *tadd, *tmul, *tround, *tsample, *tpack;
#define DBENCH_START() uint64_t time = cpucycles()
#define DBENCH_STOP(t) t += cpucycles() - time - timing_overhead
#else
#define DBENCH_START()
#define DBENCH_STOP(t)
#endif

#define N_RES (NR << 1)
#define N_SB (NR >> 2)
#define N_SB_RES (2*N_SB-1)
#define NN (NR >>2)



#define N_NTT 4096



const int32_t zetas_ct[4096] = {
	5308169, -1944892, 397876, 5557773, 7328017, -508279, -7647132, -1192636, 3709847, -747785, -130625, -4649768, -3115002, 6242210, 2679, 8449225, 1714725, -2188118, 2204651, 3701377, -2308671, 6251541, -4779155, 6749651, 908772, 5704266, 885422, 4148496, 8436269, 4280977, 7868372, -7420920, -1139327, 466410, 5512673, 1543263, 7849271, -236916, 6449787, 2337845, 4780409, 1269932, -4438190, -2328631, 2577114, 4412339, -704703, -1798832, -2349661, 656932, -4694721, 8039160, -926891, -4732256, -1977656, -7654807, -4818376, -7488709, -6824929, 5869009, 4895913, 8088114, -59590, -5718239, -2173411, -132369, 136663, -3657483, 3805960, -3834454, -1675091, 938943, 1594257, -3885205, 5078828, -5682167, -2035906, -3280051, -3569992, 136745, 4167396, -5241615, 6644816, 1141148, 4009363, -1446060, -3821881, -5206992, 4658577, 3037187, 1338529, 801618, -8237212, -2873856, -3364450, -5275812, 3050547, -8491366, 5883796, -7838770, 1824444, -4792192, -5119853, 6109767, 5106913, -5075322, 649740, -4644959, 6748612, 1943102, 4697879, -4600784, 2472706, -6701862, 8330736, 5624352, -5277245, -4124107, 8256264, -6299280, -221926, -1867251, 8586049, -7048466, 5306867, -216842, 7904950, 4082771, -6332009, 741930, 3749047, -7209957, 7622321, -6507332, -5136698, 6698086, 5860574, -654146, -5370934, 1667764, -4290811, -6923296, -8627679, -7514031, -4816751, -4256602, 7975442, 3654952, 2685529, -2570174, 4931605, 6308533, -4920077, 5868997, 1568552, 2806722, -3440707, -5306482, 4393584, 1639986, 7481893, 7349271, -2263775, 6662000, 18329, -2371182, 1562097, -2978511, -7492047, 7541302, 7828247, -3065748, 3950406, 6481439, -2504785, 3099266, -4748771, 1797517, -6150585, -6567638, -2734382, -751756, 5595182, 4080488, 2554997, 7542661, -6276423, 7666055, 445244, -1074199, 7775274, 5349707, 7151505, -785151, 7279522, -4892261, 1760546, 329341, -7166844, -2706178, 179113, -3655441, -4393154, -8639967, -8117555, -2554716, -362075, 4176038, -883398, -7048224, -2168084, 267186, -2060875, -7115502, 4821349, -6861356, -7632949, -1742626, 709001, -4839303, 7800569, -2745513, 4661298, 786353, -6280763, 7637208, -2167841, 4106357, -5398327, -4872889, 825030, -1519051, -7946923, 2164890, 6289189, -1586772, 4967655, 3466900, 8621477, 1366332, 3880973, 1342037, -3290490, 6420326, 3767678, -7954473, -4959484, -3160487, -3368225, -8242096, -7598694, -5856701, -4919998, -4746782, -5449607, 5990807, -1689387, -4870396, 7844766, 8276604, -7447705, 1057285, 2342491, 7418704, 4403507, 2182135, -6177691, 3504351, 5484824, -7913602, -5029102, 8645752, -5371207, -6933537, -3001672, -7850530, 5081553, 4279977, -1509682, -7177357, -6688824, 471113, 3039257, -6045386, -8638542, 4822796, 4249746, 6790403, -7115933, -2675909, 4827436, 4187566, 4925351, -2304511, -3165710, -7876422, 7654399, 2725540, 145037, -72392, -5716964, -5954377, -8245688, -5283148, 2493522, 3632631, 1315620, -219005, -1700693, 824795, -6039136, -6639191, -3697489, -5836777, -6456937, -2665483, -1222591, -6137480, -1160945, 7549650, -5707111, 6632190, 8093523, 2731117, -731727, -1866409, 6965232, 6744289, -542883, -723251, 4248487, -7811882, 6179907, 6706512, -1193571, -7625272, -5254581, 4317897, -1570874, -6687723, 597833, -6474575, -2870289, 1342116, 314667, 1895441, -2292936, 3134822, -7920772, 2590812, 5008316, 3148926, -7010134, -8107174, 6099197, 287666, 2899763, -6020185, -7963624, 8244392, -4339611, 3956884, -3688621, -4881470, -3917417, -3152908, 7095724, -3929039, -7200237, -6485576, 3269895, 6748178, 3148695, -6942635, -4753006, 1069084, -896249, -3464154, -5863303, -4153935, -5410240, -2907243, -7718284, -1329431, 1027450, -4655428, -1031766, 8436285, 3010266, 5834812, 359660, -5452601, 3574627, 6196618, 7448084, 1214154, 5489193, 2507651, -4929637, -6519543, 3974327, 6052198, -1332138, 613418, 4723161, 8396461, 8393814, -2303767, -5834771, -2059517, -2146782, 912980, -8395868, 441365, 405263, -8594885, 2684645, 7620084, 1465102, -962136, -2214888, -7775044, 8311184, -892195, -5158631, -1486957, 7188282, 1784240, -6477257, 7843770, 3280513, 1832732, -7515986, 5113265, 3638119, -5482271, -1010393, -8592615, -2236969, 1069834, 2532754, 8039078, 1763572, 181386, 968606, -7735641, 4755871, 2171265, 8194172, 7629823, 1343132, -3733638, -6490921, 3943404, -6451457, 4653894, 634841, -1970865, 1037010, 7733112, -3635469, 3539090, -6627059, 4102957, -6832290, -4796222, 6061645, 2054884, 7933189, 5979162, 1189261, -5008486, 1084364, -6910201, -6175656, 8139751, -1881460, 8222764, -6835316, -4648267, 938756, -4852798, 2474354, 5970225, -7329830, -3621441, 1853944, 445932, -226662, 4711950, 1959129, -4037028, 5721247, -3064823, -282687, 3359167, -5555259, 22427, -7426343, -6139702, -6918771, 4741058, 1369895, 7004531, 7492176, -4431184, 5113513, 570818, 4648487, 4930916, 6053795, 602139, 510268, -6916543, -4033013, 4370113, -8680092, -8618715, 3081212, 2216716, -2376881, -7367173, -6053775, 8361628, 1044037, 5903058, -7833105, 1856981, 5346863, -7682132, -8297135, 8016426, 8196207, -5101818, -7749204, -414495, -5886078, 4518262, -3561295, 8681993, -518389, 2968986, 5958887, -7647782, 6851122, 1223895, -4118416, 5567174, 41370, 2235772, 5727806, 7651100, -3307586, -3889441, 6756417, -3747348, 2755622, 3133842, -5211007, -2507361, -7447522, -4627804, 6969653, 2263846, 5907232, -4209588, -4682370, 6132448, 1754095, 6757086, 8419583, -4625497, 4308943, 2225862, -8362343, 7807094, -7256476, -1285124, -8683485, 8529694, 6587891, -4139207, -4836248, -7831591, 8316040, -5789917, 1601375, 2940855, 3088134, 1086248, -6032366, -2952716, -4319106, -6130969, 3734554, 2021493, 199730, -1753689, -7139610, -4037773, -6288136, -4932875, -7996182, -7714396, 3006209, -7161412, 462076, 2062906, -6091962, 7743660, 8168535, -3829157, -4389227, 6876415, 3394293, 7070819, -6769396, -1408976, 1892634, -137245, 464703, 8046786, 1941658, -4405256, 5189418, 2615966, -7027991, -6068991, 8022608, 5481067, 545790, -6736459, -7423269, 1331751, 5907924, 7223645, -2800784, 543589, 6381054, -1676450, -7774642, -3440734, -2969950, 8550883, -6072475, -1846755, -4549249, 7549489, 2495454, -2292935, -4781865, -831428, 1474594, -5156771, 1070626, 6387914, 1164638, 5556200, -8672998, -5602359, -3653913, -6555546, -7205959, -5907359, 7630534, 466063, 2571095, -7420449, 1255603, 1538950, -4864980, 4638567, 2320188, -1609139, -960990, 6777854, -2288249, -5433511, 3202614, 7449442, 4751011, -5143991, -6204584, -4713660, 1130253, -5176608, 7430249, 955552, 4132339, -1076848, -3069356, 4136632, 7150043, -1299073, -457430, -5561456, 2933845, -8650808, 3290550, 3103934, -2662069, -7357981, 2900699, 3621943, -7696671, 2371668, 5010214, -2384707, -8420835, 2712403, 3342866, -5399922, 6911573, 4678937, 1876837, 4715766, 8378836, -6380935, 4159911, 4932779, 7347878, 2957084, 1808538, 5914468, 3456594, -2627180, 4605908, 1818756, 5855802, 210499, -665775, -5125540, -2641160, 372074, 2792381, 2845955, -7746290, 4814986, 2906694, -5722014, -573704, -1460327, -7400504, -3138809, 1405911, 4554831, 4444009, -6008087, -8526685, 48047, 2205096, -917539, 1030160, 2925651, 7512710, -4126631, -248478, -2267827, -8149233, -6182658, -1374793, 8593250, -3791225, 4072451, -2732848, -6175763, 8035017, 6992126, -5977424, 157584, 6912357, 1770967, -6695393, -6043173, -6944594, -1509046, -758854, 4872089, -4854065, -5232915, 2531574, 188055, 6566407, -4730188, 6848879, 4094156, -949681, 1558876, -2593322, 4667655, -1321890, -5144828, -6644936, -2822627, 2492116, 429991, 7939451, 4284080, -2663114, 6220581, -5003754, -2614399, -7765834, 5357354, -5022865, -8595799, 4304625, -99770, -6689818, 4778255, 4288647, -822222, 5207115, -1664189, -1421745, 213900, 7064860, -5702821, -1748778, -2155894, 3606387, -315006, -5844930, 6248354, -7812971, -3443396, 339213, 8053023, -650646, -235039, -7868227, 7281827, -1509088, 277612, -345396, 393321, -1264947, 2992805, 7279769, -6207153, 4382507, 3163007, -1062868, -7961007, -3356148, 4247208, 5281170, -3833041, 7314655, -2781979, -7275572, -4885459, -1337291, -6899865, 7671986, -7437731, 5651998, -2152549, 831901, 6621901, 3162980, -8668424, -3803708, 2392832, 4423208, 3405526, 5400994, -5949779, 2455608, -5751077, 1831813, -4435087, -5938972, 2317938, -1827914, 3928787, 5371070, -3235496, -5492177, 4307286, 376000, 6420777, -4744483, -638981, -3796884, -2715900, 645472, 6755306, -4844560, 4214067, -2392584, 6618165, 263555, 4692983, 2931367, -2560803, -7725012, 1651076, 3872093, -1518122, -4166276, 3568378, -4138880, -6781797, 1892949, -2236003, 7979339, -2957837, -4525203, -1982612, 5808087, -1927390, 5459661, 3767949, -6003446, 2841780, -3873358, 3330452, -8202950, 5701260, 7980527, -5414940, 5880292, -8310242, -221774, -6684194, -6456096, 3474594, -4861548, -6319073, 3759641, 1431934, 4272848, -2075700, -1047135, 182826, -7184435, -4755885, 914678, -6189316, 2206130, -4664188, -6073857, -1239691, 8058943, -4221454, -1270420, 8362619, 6763852, 7086443, 6543432, 1139544, 4472325, -3466923, 4396513, -8116509, -8427903, -7754801, -562552, -8445064, -5615794, 600462, 7230908, 779043, 4993103, 2291502, -3412040, 850480, -3903267, 8425800, -5902565, 4044529, -5836109, -6046023, -674670, 7000277, -5978061, -8334091, 7223810, 2916750, 7925774, 4109138, 5687172, -5112050, 7197546, -3868501, 5843282, -1553400, -1989153, -3333442, -1428368, 2494821, -3745292, 1212474, 6419165, -7333531, 7991131, -974686, 6284681, 6450535, -6741998, -5652662, 4146154, 3636851, -4719447, 8042880, 6366664, 748925, 5704609, -4351889, 6652643, -6846087, 8431377, 3464143, -7543009, -584588, -7384158, -7680046, 6333246, -1209901, -3215869, -4316239, -8097256, 969581, 582680, 2192261, 1185129, 4824047, 1705808, -5132557, 3838124, 7471830, 8603180, -2760908, 1480200, 4796511, -8247381, -7731389, 8368975, -8659376, -401747, -6395832, -1506137, 5591373, 2984003, -6580715, -5556877, -7887530, -2284141, -1708707, 2966207, -648548, 8595219, -4466493, 1283059, 713035, -7451334, -7678368, -1063278, 8002741, -8016636, -6897963, 4877000, -1197310, 7626712, 1617136, 4439813, -545751, 2147400, -7015348, 1457452, 387584, 6124176, -78520, 8333918, -4494609, 1834664, 8160962, 379772, -8456193, -1117187, 6776068, 467529, 5096366, -5059631, -3630062, 442586, -6189933, -5429059, -3060340, 6990313, 5202304, -7047665, -3006465, 4247023, 2934748, 1432018, -7792718, 1576085, 251736, -2699473, -5253643, 2076982, -6418969, -2109155, -6315954, -1481152, 6177613, -6979343, 5234813, -4647988, -977998, 810694, -7888883, -5688196, 4657062, 7483409, -932014, -2841421, 4671267, 285934, 2628834, 6112090, 3370578, 3995502, -7672678, 2628112, 885744, -6204176, 7950185, -6215919, 7956166, -6569489, 7566861, -1625641, -5174986, -7900723, 6953788, 5456803, -4150250, 103936, -5919841, -7114305, 1032411, -8580170, 8236008, 383243, 4143977, -8463342, -6337686, 6731815, -7216212, -1844102, 4605507, -2144912, -3276294, -5777296, -2097664, 8602468, -5790867, 1020535, -8202810, -5339157, 3643694, -7195097, 4753131, 2365322, -3942211, -3379190, 5270530, 3842330, -2192143, -6410181, -2242661, 5491281, 3978120, -174146, -989441, 6326811, 1968633, 4118613, -3240922, -38817, 3579548, -7473285, -1353648, -7752186, -4860110, -5934667, 8368994, -879243, -7440777, -4384109, 3044866, -6987326, 5826013, -2458936, 4272366, 7592817, -6591393, -858920, -106776, 8438138, 5721979, -5464054, -631865, 1880673, -5791007, 3159181, 1922629, 4815187, 4918479, -6301770, -4071111, 4668024, -8300643, 4849384, -2613367, -5173435, 4689188, 7880541, 8094222, -7939574, -6441772, -8281785, 1675842, 6814569, 5266673, 1028731, 7650072, -3375714, 7086361, -6937859, 8199638, 2823490, -2801644, -827739, 5674737, -6398456, -5105920, 5352620, 3084483, -7076904, -1548140, -2648523, 967395, 4429432, 7256440, -2182165, -358623, -8533486, -2770282, 259474, 5254096, -989525, 4207223, 2970777, 6944894, 6035401, 4233400, 3670144, 6915532, -1384312, 8501968, 3466506, 7746882, -1003824, -2078329, -8328965, -8161614, 5454261, -2430442, 275904, -3320218, 3518585, -3643719, -2079599, -3766548, 3615965, -2436229, 7656408, -2555253, -7516869, -7693794, -3736531, -3239122, -3998769, -7279090, -5472722, 1215293, 1838364, -778079, -953780, -737289, -2844217, -4983224, -513178, -3467001, 2484066, -3825219, -4354602, 3605140, -7209956, 7987718, -6343048, -3281045, 8573885, 1386135, -5801228, 8163490, 2691298, -7265748, -3055419, -728742, -6364393, -4963545, -8321512, 5529455, 1537574, 303887, -7423794, 4829681, -3950254, 6068659, 2188304, -3494151, -7254822, -5027652, 1362919, -436835, -6897734, 3844466, 2040936, 8635642, 7381312, 1666699, 3734462, -1004345, 1602405, 4348269, 7595221, 4517083, -3746253, -6609082, -1117553, 779205, 8580246, -1960959, -1184563, 3975281, 66534, 2290986, -8070919, -3813373, 8216484, 719264, 4727691, -1937631, 3643395, 4188704, -8605399, -7926168, 5711843, -8057328, 4789175, 3401038, 6243613, 5841429, 2154617, -1841300, -1498668, -1333810, 1388118, -6403830, 111572, 2086139, -1056769, 4992767, -7752787, -7637229, -8615114, 1393063, -4860388, -7431817, -2321125, -2402713, 3082216, -6292063, -7530741, -4088499, -843783, -5524401, -6012268, 3399392, 6854482, -3795816, 2161881, -784609, 6318697, -6656774, 7124664, -6537817, -2907464, -725716, 6646603, -4645325, 1982003, 3005804, 5641216, 5674988, -466954, 5131601, -264737, -1283454, 7325206, 4823206, 8357197, -2631186, -2327116, 1787181, -6746876, 1541845, 2659730, -5010574, -3235224, -8506534, -7985360, 2385601, 384642, -5342574, -3271744, 774587, -5421187, -3904380, 6740221, 7237498, 712399, 1962031, 6356406, -6658233, 2600783, -1284712, -7042708, -3449710, 1103621, -6698170, 439995, -6459257, 4516724, -902893, -217407, -2369430, 6535892, 8372380, 5102159, -1353399, -4053011, 8102758, -7499021, 6206425, 3276133, 1243392, 3005782, 314782, 1054632, -8452368, -253936, 5483052, 5237742, -2777152, 861561, -3265044, 915035, -1621092, -5693822, 3107054, -5298347, -1967436, -3727972, 767369, -353358, 4318012, 2807340, -7670920, -6075638, 5499208, 6485062, 3832821, -5990367, 715816, -6416529, -2620991, 4690073, 6719942, -4109750, -2386473, 2692867, -1344923, 1998115, -3945965, 8008131, -5903735, 2144110, 3326986, 2169061, 4305159, 54484, -5912401, -2163896, 5112976, 337382, 1066025, -8004661, 6767140, 657805, 1991316, -2389734, 7477449, -4295256, -6252557, -6324994, -2992976, -4124847, 3591645, 8607362, 1132456, 7859979, -8233013, -4003390, -5601112, 6517802, 2369755, -7534131, -3830918, 3976315, -2562086, 2224929, 3892183, -979156, -5499820, -3003712, -1701591, -1573897, -6063555, 2493879, 8200855, 377683, -4296386, -925183, 97050, -5102920, -3665692, 8194542, 8472623, -310020, 6342774, 1074786, -4788978, -8254038, -5058535, -2732481, -5809176, -2804569, 1778942, -464339, -8156412, -4600637, 1269517, -6800425, 5359609, 1687083, 3846673, -7249416, 2123165, -330156, 5536662, 692276, -2569505, -708267, 5572477, -7590017, -6275220, 1992474, -7877038, 6578581, 615, -8299800, 7578542, -4729924, 606255, 6990732, 8034236, 8492103, 4259934, -4653968, -6620017, -1682256, -1769760, -3739194, 2429483, -3736335, 4717406, -86822, 1719845, -2664206, 6549459, -5106024, 1467766, 8621433, 5959902, 1879849, -3443530, -2114348, 2977311, 5011150, 7257421, 6969308, -399526, -1678213, 3215123, -5869637, 3479076, 5685338, 4791780, 2641173, -4097498, -3507596, -6059203, 7455972, -2879097, -2949296, -6830126, -6272688, -7295195, -227028, -1284913, 5526955, -658739, -7770726, 4540520, 7745652, -7676385, 131628, 1771265, 7992917, -1130883, -1131873, 8527203, 6289200, 5948356, 6903413, -5459389, 1007766, 2608735, -6866101, 329213, -5283137, -1586225, -6911554, -7451935, 2098931, -1483137, 6889003, 5369260, -2544607, 3450828, -248616, -6806584, -6722853, -63195, 3564395, -8661388, 8623550, 455736, -5044212, 982253, -3839728, -7370446, 2536101, 6744791, -3328831, 4512812, 2639546, 3930947, 874102, 1832346, -4737552, -340810, -1403128, -8541957, -3923519, 784146, -7367688, 1673174, 5968842, 3762986, -1798271, 2921329, -4051015, 6547389, 6362273, -7375543, -1533631, -5403757, 2229548, -3892284, -5282342, 3040933, 4938299, 3719959, -3471169, 4631155, -4673438, -5909089, 5355027, -2697869, -4294540, -8376661, 147837, 4428036, -1220221, 5362929, -3301223, -1130046, 7739781, -1805012, -2832275, 3443536, 5871943, 3651136, -6976410, 7691296, 6492941, -1689069, 3528074, -8314567, 8262897, 4585203, 5010538, -3054826, 4496270, -86460, -7774573, 7512165, 2787017, 2362120, 4248868, 566046, -6771573, -5429070, -1241575, 2251790, 705664, -7746653, -2510257, 2838804, 7725544, 7540185, 4265043, 3614750, 7856811, -7469752, 8434071, -3072608, 1508626, -4146250, -7635119, 6926471, -8309771, -583015, -7174792, -8137187, -8345108, -341699, -148407, -8073301, 5128551, -3194795, -7503405, -6595893, 8170371, -7626498, 2919984, 2489615, 6075861, 6743237, -6730414, 3836150, 5460630, 1281379, -8549275, -8225397, 3461215, -4305158, -5151016, 3185532, 6787416, 2088978, 8654016, 2731077, 3274302, -5743606, -5804887, -5334293, 4674365, -3244463, 2425396, 3347881, 3332776, -3506193, 7427669, 8221356, -1644648, -6225696, -3451441, -7226578, -7275795, 239137, -2536627, 2383415, -595984, -1048190, -2668602, -8157711, 6587443, 3496, 1108194, 1371485, -4889251, -4178266, -416802, 6249268, -3912032, 664418, -1944196, 971001, -1768884, 1800124, -7023144, 4971689, -5835446, -5005196, -2416553, -572002, -6943338, -4750015, 7683481, -498544, 8519351, -6427361, 7187959, -3175917, 6964077, -2927306, 4232865, 1664166, 7481314, 2275367, -3807355, 8166942, -1823197, 122584, 8654246, -7071369, 7728202, -4711122, -1696662, 3904826, 1804293, -7979369, -5300358, -2793132, 6989224, 6007395, -3264010, -4608210, -6145392, 1506138, -4694785, 3668963, -1561817, 6901962, 2997666, 2949927, -5378907, -1942673, -2862941, -1634270, -4489415, -5890418, 2023694, 4095244, 7253610, 3675051, -8645452, 7858116, 7017416, -5345898, 4735649, -708259, -6734555, -5126997, -7235925, 7506983, 4298167, -6361216, -8655371, 2161904, -3897533, -7614606, 5934530, -1170986, 5438304, 180597, 49314, -4546197, 3877201, -1148034, 1171106, 7616009, -398072, 3852740, -1967055, -3690766, 2794469, 4316424, 3059050, -1796157, 7922453, -2047423, -3976281, 2170153, 3950033, 5162426, 7328974, -4899701, 3838480, 303289, -3343625, 6487320, -4234183, 3313095, 1963161, -6587273, 8039218, 8112492, 494628, -297773, -6750459, -5680889, -4612726, 4242402, -7561497, -6085654, 1298192, 449473, -974094, -6642651, 7278900, 6364170, -1119158, 6510865, -8656382, -2018508, 6128573, -8368667, 1549215, 1473705, 446457, -5351874, -179033, 4776427, -5927844, -8476503, -6205519, -2619023, 2336246, 234299, -6713031, -3975523, -436936, -5817396, 1385579, -4207809, 5479199, 2273155, -1488180, -3729098, 137712, -5023067, 4943815, -613149, -1043413, 6314041, 8236867, 210484, 2009452, 6857739, -2525796, -3454990, -8434222, 2259275, 2417987, 2430283, -3103393, -3456591, 3896201, 4580526, -8442514, 5901659, 1728353, -4002308, 3548038, 5711762, 4771750, 4545729, -5326411, 759210, 3940998, 6642997, -3707720, 8409023, 671956, 7939748, -5448000, 6365636, 7036108, -2196430, -1151324, 6465133, 254822, 7800220, -8662734, 2757225, -4724165, 112318, -476599, 2406414, -4740622, 4400715, 1064266, 4104732, 5423151, -8519608, 7533783, 691333, 7153883, 407132, 5093755, 7666421, 485336, 6699327, -1986424, 1474639, 7406720, -69192, -6379153, -3380970, 8423701, -5102330, 4354495, 8354998, 3745242, 2428670, 533892, -2389748, 8135841, -853172, 2747568, 4032695, 5052095, 5708835, 2669263, 3092049, 4760045, -994286, 1683223, -6823299, 6647103, -6322683, 4988626, -7906378, -4249350, 3968590, -2689054, -1234789, 3307947, 3303602, -3299003, 3926754, -4555983, -7789471, 7827885, 3150367, 4746543, 3453809, -2455329, -2062237, 1521540, 2270153, 6734457, 1148733, -3403569, -3322930, 2322260, 3110541, -6745233, 7631230, 1872220, 1239681, 3528385, -5259262, 803597, 5985589, 17423, -7251180, 6417534, 5848977, 2773317, -7252802, 5790038, 4367243, -2918225, -6931729, 1998136, -612474, -6508049, 132059, 8060873, 1113532, -1914167, -2442868, -4464769, -7015124, 6058990, -2584637, 50271, 8429422, -4376886, -8195701, -1274193, -5864217, 2967011, 5407249, -7627380, 8126376, -6430626, 2411, -2382315, 4193410, -2333602, -3129906, 1610523, 7819613, 5250388, 1620652, 4256313, 7198200, 2893344, -6090862, 801829, -8367977, -6915583, -4425477, 3403915, 356026, -6825193, -1303653, 2354190, -5360748, 2671171, -6643221, 3273559, -7905419, 5682024, -6042631, 5042328, -4804320, -3678676, -6636106, -7358416, 3079348, -8515871, 3089129, -4160900, 5957065, -6004020, 4350578, -6924633, -5325971, 8598253, 2444467, 4594010, 6165467, 27594, 3712842, 3088686, 1874235, -331487, -3127694, -919410, 7614454, 4588530, -1153910, 561971, -2735329, -5702082, 251016, 4727732, -7007414, -3955988, 4742024, 8256901, 2192395, -4435560, 4131462, -1555983, 946309, 2653476, 3743423, -51450, -4543680, 6452852, 8380659, -4572196, -5292179, -1832535, 5606765, -1917016, 8434613, 6895986, 8132776, -5724640, 2846191, -4083649, 1680593, -2762364, -8164676, -1934614, -6304285, -5611626, -3517515, -314270, 3233276, -4876514, -8491389, 1534745, 2778094, 7261400, -4396464, 6303222, -8580371, -7664117, 6117478, -2536661, 2775348, -1930493, -6304905, 8250743, -8548874, 1825556, 3842697, 1833994, -5569056, -7499528, -4805408, 1262061, 7800396, -1306286, -111113, 3854229, 5197911, 7216072, -3913431, 8590457, -7803485, 7801689, -4418750, 7167234, -4854296, 5107886, 4651086, 4563476, 4673992, -2034710, 1321761, 98392, -242374, 7083462, 527298, 2160845, -3144449, 5000421, -5447014, -3909273, -7132412, -2310439, -8102025, 5654880, -7791687, -808968, -1791574, 5580413, 4234424, 154550, -933536, 8379997, 4243086, 8333010, 1885945, -7568331, 3224715, 8170272, -5974486, -4992641, 1577136, -8448170, -410479, 2967009, -699240, -6385674, -2275848, 6486466, 928972, 891325, -8221299, 8243566, 4204612, -7507894, -1331584, -6043759, 6299339, -6588221, 3856900, 1616886, -6788033, 3240159, -7006967, -7023421, 1524451, 8292462, 8563248, 2932875, -533962, 2752546, 6922941, -5642766, 2998230, -3476812, -5406407, 4243400, -4848479, -4831485, 7242166, -1669586, 6437748, 1715803, 6838704, -2330202, -7589124, 6288596, 2695024, 4063394, 7568581, -7212200, -878786, -7866297, -4750228, -7069359, -2198274, -8565578, -2647454, 1701073, -4183632, -5515665, -1787241, 5199370, -3816520, -143196, 2857753, 8090609, -2498364, -1376322, 3232918, 354105, -7310262, -7834686, -5968696, 2152566, -3227489, -877551, 637740, 5728441, -7330755, 7378057, 5986824, 6932902, -7756393, 2708245, 8337175, -5156208, 6848521, -539725, 2715125, 7348121, 6796255, -873071, -6055208, -5678869, -8362247, 1319019, 952053, -5931051, 3463030, 3241741, -4811566, 6952454, -1239846, 3781427, 3649581, 8014237, 2372189, 6874315, 1013906, -2529150, 2517147, 345758, -6609436, 8514356, -438120, -5228571, -271151, -5089303, 4352031, -944465, 1705591, 5527946, -5442094, -839509, 1394801, -4379262, -3281495, -7803168, -4582726, -2340308, -2446184, 3082751, 3375411, -1343974, 3223837, -4055537, 6573355, 3503498, -1867238, -5567744, -7763681, 5499412, 3724040, 3296857, 8552047, 2696252, -8185206, -6554679, 2343142, 1852854, 6881299, -1098242, -7803971, -5080126, 2256154, 484803, 3138342, -4444123, 5279034, -6298503, -6486384, -6976925, 6987589, 1258350, -8162732, -288623, -6876422, -2452651, -5349777, -5799093, 5516602, -1215282, 2062406, -2086272, 2155517, -646166, -6927987, -518010, 5240425, -2869045, -3803705, -6794604, 3129380, 2058108, 7853417, 8654885, 7526795, -5642607, -6496563, 1788627, 6090249, 8275577, 8591074, 6157351, -1958865, -7995629, 4810356, 331130, -1440530, -936298, 7166067, -6940977, 5321755, -4649058, -2945905, 5008305, -4386202, -2147711, 3960043, -7857889, -1557070, -3899218, -3003932, -7514228, 6301427, 3105733, -7172171, -548150, 8401454, 4124603, -1800540, -4266738, 5197561, -5130136, 523181, -7902595, 5036573, 4245517, 7014396, -3184755, -3381136, 3463004, -3985142, 999979, -6210578, 4738700, -2676786, 1736325, 5238405, -6529718, -880322, 3311492, -1294709, 5456443, 8172354, 1305983, 4114723, 6136151, -3780458, 4793043, 3762884, 508208, 7635670, -5774807, -652541, -5428483, 1537351, 732282, 3130609, 7922081, 8370329, 7086844, -6789198, 1788658, 5222103, -3949674, 5512287, 3646392, -6351657, 3240390, -5072648, 5650357, -2135445, 4707900, -80371, -5655654, 6498020, 8628965, -8331849, 8312044, 2474884, 5734137, -458124, 1266887, -1859456, -4372322, -1554685, -2199338, 6053878, -3123546, 4616784, -8197607, 2851604, 8588844, 8236301, 664893, 4055246, -8401180, 2422875, 1421197, -6155950, 3472029, -1264076, -4276764, -5905554, -2460913, 3054737, -2536921, 7815664, -2201504, -7798129, 49629, -6644955, 5339888, -3386733, -5295755, -7328388, 7273491, -1262860, -1626039, -4673427, -7181877, 7642137, 7134258, 5458790, 5620080, 8223592, -6572849, -4780469, 1349884, -2904441, 4873795, -518329, -3091382, -1443973, 5711968, 206853, -143740, -8238360, 3401731, 1013782, -6712786, 5970137, -7901048, -4112858, -5573873, -8112544, 4019421, 3158633, 1421737, -7272815, 6112100, -831059, 7074277, -4435740, 5179488, 6751667, -4616774, -7325183, 4613788, 8033631, -3502502, 3666585, -1135384, -4633460, 7760456, 3514511, -7433764, 8404889, -7911807, -4212382, -5945582, 873435, 2818150, 524225, -1267301, 5610226, 3162999, 5925619, -3513096, -4975306, -2130549, 7379455, 1263515, 1255403, -5195467, -1843843, 3169622, 3644698, -4337930, 4500273, -2656586, 437609, -2260320, 5144340, -1046902, 8223634, 4123358, -8391484, -586677, -5664225, 1261853, -2060984, 6638032, 6810373, -4013843, 8139008, -6201863, -6964494, -3436558, -6651461, -3442206, -5904684, 7703716, -1344444, -7854973, -7588141, -307037, 5158113, 1997584, -1400461, -6214731, 5499063, -1300561, -213117, -7655502, 7435251, 3093377, 5518880, 2893634, -6369048, -2076965, -2460518, -5025688, -5169166, 8656649, -7699658, 7619362, -1512967, 5361649, 651486, 2526468, 5924456, 1592639, 5571879, 6304258, -6220531, 1394935, -6834712, 8227094, 6111944, -2403157, 1309765, 8412213, 647674, -7251862, 1714748, 4281014, -8351989, -4112827, 7032902, 6534885, -962095, 7066764, 7083013, 6838053, -851778, -3835587, 1592701, 7720164, -7061480, -329382, 6830329, -3154306, 7773692, 4851844, 5806391, 2987945, -6050309, -4676096, 6342218, -6515504, -2298458, -8609090, 2441512, -1300723, -8561578, -4291225, -3172526, -31424, 7746357, 151162, 5430534, 5780937, -4628872, -3185045, -3102950, 227516, -2297297, -3521761, -2651935, -2892031, -5469101, 7400290, -7674997, 675685, -7973928, -366493, -8234347, -1488391, 3300350, 4530161, -4090909, -3735912, 2395275, -7327703, 4039797, 5493251, -7493442, -7758922, 8428523, 4247413, -4625726, -7095874, -2514570, 1746407, -3714239, -6797073, -6719017, 1813299, -2485305, -6486598, -4515303, 3669431, -7851192, -2235307, 4386221, -5680706, 1065370, -8497477, -542132, 8469535, -6310295, 3899361, -3241650, 2756591, 647272, -7756836, 3792503, -5172049, -1071939, 3961137, 7925322, 5287136, -6202363, 8664171, -422731, 1335331, -3197251, 5309667, 4283586, -6516976, 1389257, -6444393, 2908120, -8293063, 6026674, 3413540, -5882554, 3042276, -1515491, 31036, 5920606, -3820687, -6711669, 7676062, 2785495, -2793834, -1931238, 2083235, 7824351, -3299459, 1010542, 5836370, -4624569, 6107610, -7303515, -7394910, 4909621, -510451, -4765409, -594149, 784745, -6749415, 3737866, -3269238, -6659777, 978188, 2356114, -4073223, 1021597, -5734134, 934337, 7919547, -217989, -1237258, -7159343, -2468745, 4459270, 6194148, -7792748, -1831324, -4777399, 4636770, -2513951, 1422428, -7576347, 6270714, 6553779, -716276, -3752516, 451110, 3838767, 7006481, -4438183, 3742029, -3951264, -570610, -2392148, 2732726, -1612205, -5330778, -3555554, -6495113, 4251677, -2929587, 1452180, 6552470, 135186, 5475600, -1700368, -4630870, 7034984, -8069562, -2599865, 8475079, 5379279, -4536705, -4243949, 3562308, 1604908, -5477040, -1110339, 7136424, 1943756, 6037823, 832113, 2566686, -1035154, 5239112, -5289068, -5931073, 5759815, -6235305, 4634017, -820600, -1532753, -5063286, -4914867, -5690432, 2849473, -6441190, -3877350, -7163558, -7894449, 1230963, 3616082, -4807295, 3201248, -4608978, 2922769, 8194792, 7633944, -4712671, -4685260, 175590, -1353915, -1607340, -6201809, -7354596, -4178214, -4930851, 3388408, -977480, 5827908, 1191522, -5021469, -1192488, 7984252, 5904355, 8012252, -3516392, 4414602, -2441395, -7403824, 3628888, 5408813, -5368446, -8623878, -3782557, 2225293, 8635559, -3638135, 59894, -3915647, -3438322, 8574992, 6652569, -7014647, 6398966, -773075, -2109334, -5784928, 351251, -3015483, -8438875, -6931366, -4767527, -5722148, 4593775, -7981830, -1738708, 4353651, 4990059, -417821, -4268402, -4225315, 1688674, 7470713, 8671280, 4974690, 3571563, -5476472, -8339062, -1590035, -5155793, -2532525, -3332695, -1003097, -7030530, -3872970, -3313002, -6838621, 2278757, -7738895, 3346844, 845040, -1664287, 8181662, 6941447, 5605798, 5434967, -2726753, -718317, 8026699, -8113773, -4266282, 2641721, 1844552, 1876586, -6182320, -5558584, -980071, -5896994, 2652979, -4167565, 1571004, 3546354, 4692160, -5446719, 1304095, 2306426, 7879272, -3965413, -3583972, -1876210, 7977546, 4911259, 6901593, 3259668, -1527126, 7102882, 3457514, -5515683, -4644519, -7201113, -6603444, -1219798, 3040798, 6824937, 1189906, -2432893, 4921661, 5574099, 3464161, -353165, -5568714, -2467147, 3405460, -5461796, -1121061, -7457015, 5197107, 1206264, 7905719, -6342016, 4232858, -4978451, -3650704, -6478248, -4739916, -427565, -6063234, -5186509, -3969187, -5523423, -214148, -2189868, 4156028, 4751449, -5085057, -2247377, 4586108, -5215357, 1665429, 3324989, 5041535, 3798280, -7246864, -3972617, 4883597, 3155528, 6744313, -2613890, 4755035, 4492547, -587399, 2006770, -2067699, 6847100, -427497, 4745831, 423850, 293789, -6702760, 117648, 5599933, -6475406, 6427494, -7712116, 5210201, -7284589, -547610, -6334262, 7813828, 3019067, 1943709, 2436253, 7425669, 227322, -4147336, 4479595, -1457806, 6366200, 8140839, 5516103, 1846175, 5547671, -408999, -2604557, -7311848, -4797195, -2894118, -1858852, 1986445, -7732528, -4673425, 5911117, 4639812, -985743, 2495657, 8257892, -2590960, 2610568, -5281320, 3686144, 5341199, -3228867, -6699565, 6982366, -5858981, -272468, 4575556, 5161671, -8016698, -39882, 8194343, 578716, 3958640, -317534, 6124762, 5057909, 8156456, -8036638, 1988745, -2165043, 2500296, 7306252, 607565, -522444, -3920749, 4781132, -5532022, 3878197, 651313, 1581091, 1797623, -8004706, -376055, 1081590, -1494436, 3496115, 7131357, -2444331, 7030521, 4296085, -6879259, 2750548, 2371821, 6757663, -2786680, 5306624, -4056013, -6780482, -1314594, -4784673, 4976270, -4109864, -3115526, 6292842, -6408456, -7773074, 8110367, 6292324, -7588376, -1985253, 7897023, 5880917, -1723419, -7738047, -816530, -3298465, -3296600, 4586980, 7519308, -8318004, 846864, 4920713, 8252954, 6412625, -3455411, -1015373, -222309, -2231911, 5081066, 5701578, 6580405, -3455421, -2210988, -7687701, 2151176, 5932546, 2289235, 1343739, -4093, -1963209, -1032135, 6007330, -5729145, 2423447, 785893, -2891328, -3867781, 7584217, -5528101, -7526625, 6695220, 770949, -6892548, 3384369, -5208095, -7975600, 209565, 925879, 6182120, 3638890, -4664817, 4109227, -5376149, -6983555, -3420681, 1310139, -1908106, 5561128, 5366752, -1523057, -5725633, 3809003, 4505145, 1908140, 918206, 7999725, -2990404, -289196, 6369141, 3877717, -6074603, 837023, -2363711, -5374163, -1462959, -683932, 1392466, 8097795, 3543830, -6634708, -177599, 6976847, -2002086, 3032940, -7291862, 291403, 2413083, -6213293, 2203281, 816324, 5874103, -5496422, 7780490, 2443694, 1844845, -3984632, 8025042, 7026506, -3884911, 263946, -8497767, 2649776, -4684577, 110788, 4994109, -5013748, -2848895, -4324377, 8147799, 5033804, 2534021, 3051822, 2861708, -6701465, 2656011, -186099, 415712, 6856907, -6720890, 7584688, -230824, 694596, -4794993, -5441423, 2571796, -6150179, -10282, 6179327, 7262884, 5431888, 586133, 7030531, -1757306, -7530603, 450258, 4923197, 3115375, 5011611, -610706, -3682346, 7065065, -8411176, -3918110, -7050649, 3808472, 7656473, -3815332, 6274097, -6392993, -4519628, -8528225, -325713, -1240566, -1164577, -1662216, -1362642, 3884073, -8569959, 2393482, -4309393, -4189648, 2703917, -7153861, 1911800, -8581328, -3549072, -1965113, 1350154, 5220647, 497180, -6219218, -4040796, 7763778, 444504, -2759799, -6285463, 2563924, -8401262, -4804600, -747078, -7262590, 584059, 1108984, -7886366, -709930, 1783354, -3104513, 7145866, 1390265, -5394465, -5463469, -5916202, 4430080, -4657187, 3414664, -5671501, -2374866, -1829385, 1986226, 1755766, -5864929, -7412492, 4288553, 3474083, 598326, -648755, -1090822, -6366329, 6116084, -6789550, -5072366, -7474305, -6962699, 6012465, -1073140, -5669404, 524242, 6183065, -7222153, 1406463, 5342818, -2804491, -3206561, 7266575, 820034, -7222772, 5549579, 8671752, 4641691, 2113450, -798394, -5035569, 955667, -4454012, 4344952, 6061406, -6938350, -4864890, 1557916, -740686, 5889211, -1822949, -6822584, -7661708, 6441615, -6527986, 7758688, 6136449, 3000271, -5942104, -8571286, -5858378, 1901242, 8637401, -6483050, -1592556, -3974680, -7717336, -7149492, -289946, -8481863, -1258875, -5706379, 521274, -8131911, -3619304, -6577610, 8452655, 300233, -8019444, -1090265, 3060071, -1817382, -4019831, -4561926, -2728831, 6259968, -6374307, -4077055, -7032313, -3240560, -6884897, -7750945, 6700468, 1174918, -3261474, -7280444, 2749929, -3262576, -6141674, -4575625, -841783, 5133208, -6376260, -1484980, 4228298, -5453063, -2517743, 1276433, -678494, 2044861, -2267337, 2772757, -5086311, 4596009, -4552018, 2180915, -5809329, -4187341, -8288292, -6574736, 1435250, -4185782, 1750403, 5388001, 3136151, 4850803, 3634546, 460399, 5306201, -1733882, -4332399, 2548230, 6989604, 2648558, -8244800, -3260428, 3971691, -1360321, -6277344, 404992, 768065, -7359899, -8381739, -8680459, -7429900, -3446243, 740582, 6547140, 4163804, 3474053, -6565405, 7481961, -5885356, 3346584, -7222723, 7538711, -3375542, -6133856, 7668376, -1579341, 7352019, -5446810, -4752448, 2809497, -235929, -7478563, 418285, -2401855, 6752092, -1395130, -7675492, 859770, -1937012, 906706, 4408869, -3440519, -4600747, -4613599, -7096050, -1507331, 6393111, 1849087, -7243353, -8004658, 86129, -7522802, 4083011, -4541992, 192131, 7691652, -8013214, 3713075, -367701, 2626030, 36880, -4236684, 5605711, -3384583, -3461534, -5809062, 6670177, 3522614, 182583, -2792036, -1591239, -3321665, -8509174, 976768, -6002254, -4769386, -6819879, 2821326, -6113646, 4350214, 3224256, 4175906, -7127091, 3356402, 1137881, -4229543, -4778406, -7503151, -1650155, -463949, 8292718, 8676995, -8612088, 1245108, -7021507, -7258393, 7090603, -573703, -1957723, 7239668, 4578854, -3010951, -5103422, -8094823, 2126547, -67080, 5164475, -8670333, -4833101, 5438698, -6277696, 2419470, -724391, -6747647, -7881561, 3663768, 2882819, -3779854, -224348, 1534036, -2979313, -1511405, -1316557, -3792847, 2996446, -5461589, -789730, 1193455, -1524075, -5228195, 2592834, -1085445, 661250, 4675293, 8272616, 7478950, 6301726, 8664681, -6255075, -7542273, 902689, 6868322, 2905394, 2112525, -1372511, -5453283, 8261436, -1558995, 4238087, 2763307, -1663604, 819215, 2532662, 5013240, -7870095, 210549, 8207765, -5529199, -3721691, -3700711, -8340316, 7757423, -7289823, -3551603, -3458908, 5805094, 1133075, -2972965, 5229266, -5186444, -1728366, 7727732, -3898940, -5186970, 4523152, 596423, 547295, -5185831, 164898, 3392971, -5634079, -1621926, 7255862, 2233429, -5830925, 599114, 7808, -5214237, 2447741, 1675665, 5814601, 1645338, -1083382, 698207, 2914612, -5053135, 6032582, 2505970, 389442, -7551578, -1621709, -442943, 982250, 4567999, -3403065, 7212690, -1197004, -8404397, -1988990, -615257, 5635051, -388431, 7851866, -5121655, -1389581, -5846857, 7647187, 4134194, 6833853, -7602420, 1490571, 1195957, 7790482, -375571, 4190568, 8581946, 931506, 2101852, -2873635, -2993873, -67426, 840357, -5334320, 1518970, 882997, 7073570, 1570629, -3257937, 3817450, -3477969, -7537300, 2562619, -3362242, -2123864, -6625869, 7752343, 6201647, 7411240, 6403182, 2728356, -6513209, -2703374, -7424628, -5988246, -4823879, -6881025, 4754854, -2961573, 4130613, 8603609, 4853860, -4152252, -1609256, -3525454, -6768492, -2635467, 2922880, 4861818, 5524616, 4339747, -3328182, -2457702, 432336, -6538176, 3208219, 5665959, 4713584, 4887408, 3588563, 6961520, 7441256, -5890092, 7790198, 855041, 1597179, 8403191, 8639429, 2830200, -6780010, -1647593, -5977147, 3604822, 4555762, 1653515, 8231901, -774910, 1389395, -6311308, 8675100, -2282872, -3737428, -6690481, -6750057, 6030530, -7130355, 6247888, -4615711, -679426, 3918290, 2794563, -8367744, 7238979, 4125621, -2297978, -6191669, -3927533, 1726894, -4040017, 7351141, 5695874, 4180669, -5517540, 5826023, 2785689, -6708931, -7309634, 4445803, 894631, 5427279, 4168963, 1432068, 5933179, 4827000, -7131920, 5280187, 8009229, 216767, -6598458, -7972088, 7739952, -6700369, -2826930, -1703471, -5972418, -1805164, -2922838, 1118640, -7690785, -2030597, -5737774, 3594681, -224745, -1971668, 5046127, -8205288, 5069470, -158720, -1054976, 4618919, 476658, 4499740, 776945, -4972658, -4536574, -4014966, -8031009, -527192, 753600, 1810206, -7183760, 4704334, 1184449, -759344, 2347810, -5950412, -1679691, -916563, 7997525, 4259814, 7193459, -4582864, 3264411, -1387718, -5358281, -572904, -7617508, -648538, -7167844, -220629, 7189038, -2653721, 3677958, 2773147, -5293137, 506600, -4475924, 2351237, 586043, -3191696, 522330, -6838419, -5145085, -5418737, -8650026, 5555163, 2105798, -8666889, 3149778, -7154214, 4940837, -1183826, 5184668, -1549194, 1859786, 3205541, -8413542, 5793841, 5989168, -5077555, -6438289, -1066590, 3274819, -7149560, 8501202, -3047355, -5829232, 8204938, 3051497, 1068200, -2423777, -6615198, -328034, -2990093, -4944420, -8069150, 4909917, 1055121, -297813, 3569280, -3166704, 1483925, -5963102, -628948, -6197293, 140070, 4572490, 791883, -983065, -4246746, 512490, -5553485, -2038622, 1178483, -2335012, -6227169, -6404402, 3216836, -4276820, -6361876, -4862781, 6953308, 1174807, 2218795, -3039382, -6816602, -3795584, 1962756, -1407864, 4138011, 1986079, 4163207, -4457129, -8014342, -1672603, 1574274, 2228505, 7826999, 7234136, 6733778, 3357117, 5583861, 7394614, -8466705, -1794188, -5674555, -882552, -4907090, 717195, -6337844, -5039182, 6820106, 4267056, -5721658, 7291806, -7831819, 3378142, 7801788, -6070762, -2287182, -3941817
};

#define Q_NTT_CT (int32_t)17367041
#define QINV_NTT_CT (int32_t)-17367039 //Q_NTT^(-1) mod 2^32
#define F_INVNTT_CT (int32_t) 3546131 // mont^2/N_NTT.. 2^(128-�꽮12)%Q_NTT


	
	
#define Q_NTT_MULTI_Q1 (int32_t)134250497 
#define Q_NTT_MULTI_Q2 (int32_t)536903681  


#if NIMS_MODE == 2
#define R_BARRETT 16289729
#define QINV 1823557619

#elif NIMS_MODE == 3
#define R_BARRETT 16264832
#define QINV -772263355

#elif NIMS_MODE == 5
#define R_BARRETT 16282066
#define QINV 1244083967
#endif

#define _mm256_blendv_epi32(a,b,mask) \
  _mm256_castps_si256(_mm256_blendv_ps(_mm256_castsi256_ps(a), \
                                       _mm256_castsi256_ps(b), \
                                       _mm256_castsi256_ps(mask)))


void poly_tomont(poly *a_mont, poly *a) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		a_mont->coeffs[i] = to_mont(a->coeffs[i]);

}
void mont_reduce_woo(poly *a_mont, poly *a) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		a_mont->coeffs[i] = to_mont_woo(a->coeffs[i]);

}

void poly_frommont(poly *a, poly *a_mont) {
	unsigned int i;
	for (i = 0; i < N; ++i)
		a->coeffs[i] = from_mont(a_mont->coeffs[i]);
}







int32_t montgomery_reduce_Q_NTT_ct(int64_t a)
{
  	int32_t t;
	t = (int32_t)a * QINV_NTT_CT;
	t = (a - (int64_t)t * Q_NTT_CT) >> 32;
  return t;
}


void ntt_ct(int32_t a[N_NTT]) {
unsigned int len, start, j, k;
  int32_t zeta, t;
  k = 0;
  for(len = N_NTT>>1; len > 0; len >>= 1) {
    for(start = 0; start < N_NTT; start = j + len) {
      zeta = zetas_ct[++k];
      for(j = start; j < start + len; ++j) {
        t = montgomery_reduce_Q_NTT_ct((int64_t)zeta * a[j + len]);
        a[j + len] = (a[j] - t);
        a[j] = (a[j] + t);
      }
    }
  }
}



void poly_pointwise_montgomery_1_ct(int32_t *c, const int32_t *a, const int32_t *b) {
  unsigned int i;

  for(i = 0; i < N_NTT; ++i)
    c[i] = montgomery_reduce_Q_NTT_ct((int64_t)a[i] * b[i]);

}




void invntt_tomont_ct(int32_t a[N_NTT]) {
    unsigned int start, len, j, k;
  	int32_t t, zeta;
 	k = N_NTT;
  	for(len = 1; len < N_NTT; len <<= 1) {
    for(start = 0; start < N_NTT; start = j + len) {
      zeta = -zetas_ct[--k];
      for(j = start; j < start + len; ++j) {
        t = a[j];
        a[j] = (t + a[j + len]) % Q_NTT_CT;
        a[j + len] = (t - a[j + len])% Q_NTT_CT;
        a[j + len] = montgomery_reduce_Q_NTT_ct((int64_t)zeta * a[j + len]);
      }
    }
  }
 	for(j = 0; j < N_NTT; ++j) {
    	a[j] = montgomery_reduce_Q_NTT_ct((int64_t)F_INVNTT_CT * a[j]);
  	}
}

void reduce_modQ(int64_t *a)
{
  int64_t ar;
  for (int i = 0; i < N_NTT; i++)
  {
	ar = a[i] - ((a[i]) >> 24) * Q;
	a[i] = ar - (((ar >> 20) * R_BARRETT) >> 28) * Q; 
  }
}
int32_t reduce_multi_modQ(int64_t a)
{
  	int64_t ar;
	ar = a - (a >> 24) * Q;
	a = ar - (((ar >> 20) * R_BARRETT) >> 28) * Q; 
	return a;
}




void poly_mul_NTT_ct(poly* res, poly* a, poly* b)
{
	uint32_t i;
	int32_t A[N_NTT]={0,};
	int32_t B[N_NTT]={0,};
	int32_t E[N_NTT]={0,};


	for(i=0;i<N;i++){
		A[i]=(int32_t)(a->coeffs[i]);
		B[i]=(int32_t)(b->coeffs[i]);
	}
	ntt_ct(A);
	ntt_ct(B);
	poly_pointwise_montgomery_1_ct(E, A, B);
	invntt_tomont_ct(E);

	for (i = N; i < 2 * N - 1; i++) {
		E[i - N] = E[i - N] + E[i];
		E[i - N + 1] = E[i - N + 1] + E[i];
	}

	for (i = 0; i < N; i++)
		res->coeffs[i] = E[i];

}


void poly_reduce(poly *a) {
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		a->coeffs[i] = reduce32(a->coeffs[i]);

	DBENCH_STOP(*tred);
}

void poly_caddq(poly *a) {
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		a->coeffs[i] = caddq(a->coeffs[i]);

	DBENCH_STOP(*tred);
}

void poly_freeze(poly *a) {
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		a->coeffs[i] = freeze(a->coeffs[i]);

	DBENCH_STOP(*tred);
}

void poly_add(poly *c, const poly *a, const poly *b) {
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		c->coeffs[i] = a->coeffs[i] + b->coeffs[i];

	DBENCH_STOP(*tadd);
}

void poly_modadd(poly *c, const poly *a, const poly *b) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		c->coeffs[i] = mod_add(a->coeffs[i], b->coeffs[i]);

}

void poly_sub(poly *c, poly *a, poly *b)
{
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		c->coeffs[i] = a->coeffs[i] - b->coeffs[i];

	DBENCH_STOP(*tadd);
}

void poly_modsub(poly *c, const poly *a, const poly *b) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		c->coeffs[i] = mod_sub(a->coeffs[i], b->coeffs[i]);

}

void poly_shiftl(poly *a) {
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		a->coeffs[i] <<= D;

	DBENCH_STOP(*tmul);
}

void poly_pointwise_montgomery(poly *c, const poly *a, const poly *b) {
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		c->coeffs[i] = montgomery_reduced((int64_t)a->coeffs[i] * b->coeffs[i]);

	DBENCH_STOP(*tmul);
}

void poly_power2round(poly *a1, poly *a0, const poly *a) {
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		a1->coeffs[i] = power2round(&a0->coeffs[i], a->coeffs[i]);

	DBENCH_STOP(*tround);
}

void poly_decompose(poly *a1, poly *a0, const poly *a) {
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		a1->coeffs[i] = decompose(&a0->coeffs[i], a->coeffs[i]);

	DBENCH_STOP(*tround);
}

unsigned int poly_make_hint(poly *h, const poly *a0, const poly *a1) {
	unsigned int i, s = 0;
	DBENCH_START();

	for (i = 0; i < N; ++i) {
		h->coeffs[i] = make_hint(a0->coeffs[i], a1->coeffs[i]);
		s += h->coeffs[i];
	}

	DBENCH_STOP(*tround);
	return s;
}

void poly_use_hint(poly *b, const poly *a, const poly *h) {
	unsigned int i;
	DBENCH_START();

	for (i = 0; i < N; ++i)
		b->coeffs[i] = use_hint(a->coeffs[i], h->coeffs[i]);

	DBENCH_STOP(*tround);
}

int poly_chknorm(poly *a, int32_t B) {
	unsigned int i;
	int32_t t;
	DBENCH_START();

	if (B > (Q - 1) / 8)
		return 1;

	for (i = 0; i < N; ++i) {
		/* Absolute value */
		t = a->coeffs[i] >> 31;
		t = a->coeffs[i] - (t & 2 * a->coeffs[i]);

		if (t >= B) {
			DBENCH_STOP(*tsample);
			return 1;
		}
	}
	DBENCH_STOP(*tsample);
	return 0;
}

static unsigned int rej_uniform(int32_t *a,
	unsigned int len,
	const uint8_t *buf,
	unsigned int buflen)
{
	unsigned int ctr, pos;
	uint32_t t;
	DBENCH_START();

	ctr = pos = 0;
	while (ctr < len && pos + 3 <= buflen) {
		t = buf[pos++];
		t |= (uint32_t)buf[pos++] << 8;
		t |= (uint32_t)buf[pos++] << 16;
		t |= (uint32_t)buf[pos++] << 24;
		t &= 0x1FFFFFF;

		if (t < Q)
			a[ctr++] = t;
	}

	DBENCH_STOP(*tsample);
	return ctr;
}

#define POLY_UNIFORM_NBLOCKS ((768 + STREAM128_BLOCKBYTES - 1)/STREAM128_BLOCKBYTES)
void poly_uniform(poly *a,
	const uint8_t seed[SEEDBYTES],
	uint16_t nonce)
{
	unsigned int i, ctr, off;
	unsigned int buflen = POLY_UNIFORM_NBLOCKS * STREAM128_BLOCKBYTES;
	uint8_t buf[POLY_UNIFORM_NBLOCKS*STREAM128_BLOCKBYTES + 2];
	stream128_state state;

	stream128_init(&state, seed, nonce);
	stream128_squeezeblocks(buf, POLY_UNIFORM_NBLOCKS, &state);

	ctr = rej_uniform(a->coeffs, N, buf, buflen);

	while (ctr < N) {
		off = buflen % 3;
		for (i = 0; i < off; ++i)
			buf[i] = buf[buflen - off + i];

		stream128_squeezeblocks(buf + off, 1, &state);
		buflen = STREAM128_BLOCKBYTES + off;
		ctr += rej_uniform(a->coeffs + ctr, N - ctr, buf, buflen);
	}
}

static unsigned int rej_eta(int32_t *a,
	unsigned int len,
	const uint8_t *buf,
	unsigned int buflen)
{

	unsigned int ctr, pos;
	uint32_t t0, t1;
	DBENCH_START();

	ctr = pos = 0;
	while (ctr < len && pos < buflen) {

	
#if ETA == 2
		t0 = buf[pos] & 0x0F;
		t1 = buf[pos++] >> 4;

		if (t0 < 15) {
			t0 = t0 - (205 * t0 >> 10) * 5;
			a[ctr++] = 2 - t0;
		}
		if (t1 < 15 && ctr < len) {
			t1 = t1 - (205 * t1 >> 10) * 5;
			a[ctr++] = 2 - t1;
		}
#elif ETA == 1
		t0 = buf[pos] & 0x03;
		t1 = (buf[pos] >> 2) & 0x03;
		t2 = (buf[pos] >> 4) & 0x03;
		t3 = buf[pos++] >> 6;
		if (t0 < 3)
		{
			a[ctr++] = 1 - t0;
		}
		if (t1 < 3 && ctr < len)
		{
			a[ctr++] = 1 - t1;
		}
		if (t2 < 3 && ctr < len)
		{
			a[ctr++] = 1 - t2;
		}
		if (t3 < 3 && ctr < len)
		{
			a[ctr++] = 1 - t3;
		}
#endif	
	}
	DBENCH_STOP(*tsample);
	return ctr;
}

#define POLY_UNIFORM_ETA_NBLOCKS ((136 + STREAM256_BLOCKBYTES - 1)/STREAM256_BLOCKBYTES)
void poly_uniform_eta(poly *a,
	const uint8_t seed[CRHBYTES],
	uint16_t nonce)
{
	unsigned int ctr;
	unsigned int buflen = POLY_UNIFORM_ETA_NBLOCKS * STREAM256_BLOCKBYTES;
	uint8_t buf[POLY_UNIFORM_ETA_NBLOCKS*STREAM256_BLOCKBYTES];
	stream256_state state;

	stream256_init(&state, seed, nonce);
	stream256_squeezeblocks(buf, POLY_UNIFORM_ETA_NBLOCKS, &state);

	ctr = rej_eta(a->coeffs, N, buf, buflen);

	while (ctr < N) {
		stream256_squeezeblocks(buf, 1, &state);
		ctr += rej_eta(a->coeffs + ctr, N - ctr, buf, STREAM256_BLOCKBYTES);
	}
}

#if N==1201
#define POLY_UNIFORM_GAMMA1_NBLOCKS ((3003 + STREAM256_BLOCKBYTES - 1)/STREAM256_BLOCKBYTES)
#elif N==1607
#define POLY_UNIFORM_GAMMA1_NBLOCKS ((4018 + STREAM256_BLOCKBYTES - 1)/STREAM256_BLOCKBYTES)
#elif N==2039
#define POLY_UNIFORM_GAMMA1_NBLOCKS ((5098 + STREAM256_BLOCKBYTES - 1)/STREAM256_BLOCKBYTES)
#endif
void poly_uniform_gamma1(poly *a,
	const uint8_t seed[CRHBYTES],
	uint16_t nonce)
{
	uint8_t buf[POLY_UNIFORM_GAMMA1_NBLOCKS*STREAM256_BLOCKBYTES];
	stream256_state state;

	stream256_init(&state, seed, nonce);
	stream256_squeezeblocks(buf, POLY_UNIFORM_GAMMA1_NBLOCKS, &state);
	polyz_unpack(a, buf);
}

void poly_challenge(poly *c, const uint8_t seed[SEEDBYTES]) {
	unsigned int i, b, pos;
	uint32_t signs;
	uint8_t buf[SHAKE256_RATE];
	keccak_state state;

	shake256_init(&state);
	shake256_absorb(&state, seed, SEEDBYTES);
	shake256_finalize(&state);
	shake256_squeezeblocks(buf, 1, &state);

	signs = 0;
	for (i = 0; i < 4; ++i)
		signs |= (uint32_t)buf[i] << 8 * i;
	pos = 4;

	for (i = 0; i < N; ++i)
		c->coeffs[i] = 0;
#if (N==1021)
	for (i = N - TAU; i < N; ++i) {
		do {
			if (pos >= SHAKE256_RATE) {
				shake256_squeezeblocks(buf, 1, &state);
				pos = 0;
			}

			b = (uint32_t)buf[pos++] << 2;
			b |= (buf[pos++] & 0x3);
		} while (b > i);

		c->coeffs[i] = c->coeffs[b];
		c->coeffs[b] = 1 - 2 * (signs & 1);
		signs >>= 1;
	}
#else
	for (i = N - TAU; i < N; ++i) {
		do {
			if (pos >= SHAKE256_RATE) {
				shake256_squeezeblocks(buf, 1, &state);
				pos = 0;
			}

			b = (uint32_t)buf[pos++] << 3;
			b |= (buf[pos++] & 0x7);
		} while (b > i);

		c->coeffs[i] = c->coeffs[b];
		c->coeffs[b] = 1 - 2 * (signs & 1);
		signs >>= 1;
	}
#endif
}


void poly_mul_schoolbook(poly* a, poly* b, poly* res)
{
	// Polynomial multiplication using the schoolbook method, c[x] = a[x]*b[x] 
	// SECURITY NOTE: TO BE USED FOR TESTING ONLY.  
	uint32_t i, j;

	uint32_t c[NR << 1];
	uint32_t t0;
	for (i = 0; i < (NR << 1); i++) c[i] = 0;

	for (i = 0; i < N; i++)
	{
		for (j = 0; j < N; j++)
		{
			t0 = ((uint64_t)a->coeffs[i] * (uint64_t)b->coeffs[j]) % Q;
			c[i + j] = (c[i + j] + t0) % Q;
		}
	}

	for (i = N; i < 2 * N - 1; i++) {
		c[i - N] = mod_add(c[i - N], c[i]);
		c[i - N + 1] = mod_add(c[i - N + 1], c[i]);
	}
	c[N - 1] = mod_add(c[N - 1], c[2 * N - 1]);
	c[0] = mod_add(c[0], c[2 * N - 1]);
	c[1] = mod_add(c[1], c[2 * N - 1]);

	for (i = 0; i < N; i++)
		res->coeffs[i] = c[i];
}

int32_t crt_mode(const int32_t a, int32_t b_pinv, int32_t b, int32_t p) {
  int32_t t, u;
  t = ((int64_t)a * b_pinv) & 0xffffffff; 
  u = (((int64_t)a * b) >> 32) & 0xffffffff;
  t = (((int64_t)t * p) >> 32) & 0xffffffff;
  t = u - t;
  return t;
};

void ntt_crt(poly *c, poly *a, poly *b) {
  int32_t tmp0[N];
  int32_t tmp1[N];

  for (int32_t i = 0; i < N; i++) {
    tmp0[i] = crt_mode(a->coeffs[i], MONT_PINV, Q1_MONT, Q_NTT_MULTI_Q1);
  }

  for (int32_t i = 0; i < N; i++) {
    tmp1[i] = b->coeffs[i] - tmp0[i];
  }

  for (int32_t i = 0; i < N; i++) {
    tmp1[i] = crt_mode(tmp1[i], CRT_U_PINV, CRT_U, Q_NTT_MULTI_Q2);
  }

  for (int32_t i = 0; i < N; i++) {
	// tmp1[i] = reduce_multi_modQ((int64_t)tmp1[i] * Q_NTT_MULTI_Q1);
	tmp1[i] = ((int64_t)tmp1[i] * Q_NTT_MULTI_Q1) % Q;
  }

  for (int32_t i = 0; i < N; i++) {
    c->coeffs[i] = (tmp0[i] + tmp1[i]) % Q;
	if (c->coeffs[i] > Q / 2) {
		c->coeffs[i] -= Q;
	}else if(c->coeffs[i] < -Q / 2) {
		c->coeffs[i] += Q;
	}
  }
}
